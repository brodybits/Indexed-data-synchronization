// Generated by CoffeeScript 1.10.0
(function() {
  var bodyParser, express, i, promisify, start;

  i = require('../index.js');

  express = require('express');

  bodyParser = require('body-parser');

  promisify = require('promisify-node');

  start = function() {
    var MY_DB_NAME, MY_STORE_NAME, app, db, db1;
    MY_DB_NAME = ':memory:';
    MY_STORE_NAME = 'MyStore';
    app = express();
    app.use(bodyParser.json());
    db1 = i.newSQLiteDataStorage(MY_DB_NAME);
    db = promisify(db1, void 0, true);
    db.addStore(MY_STORE_NAME);
    app.post('/echoBody', function(req, res) {
      return res.send(req.body);
    });
    app.post('/add', function(req, res) {
      var b;
      b = req.body;
      return db.addStoreRecord(MY_STORE_NAME, b.key, b.value).then(function() {
        res.status(200);
        return res.send();
      }, function(error) {
        res.status(400);
        return res.send();
      });
    });
    app.post('/delete', function(req, res) {
      var b;
      b = req.body;
      return db.deleteStoreRecord(MY_STORE_NAME, b.key).then(function() {
        res.status(200);
        return res.send();
      }, function(error) {
        res.status(400);
        return res.send();
      });
    });
    app.get('/get', function(req, res) {
      var b;
      b = req.body;
      return db.getStoreRecord(MY_STORE_NAME, b.key).then(function(value) {
        return res.send(value);
      }, function(error) {
        res.status(400);
        return res.send();
      });
    });
    return app.get('/changes', function(req, res) {
      var b;
      b = req.body;
      return db.getStoreChanges(MY_STORE_NAME, b.after).then(function(changes) {
        return res.send(changes);
      }, function(error) {
        res.status(400);
        return res.send();
      });
    });
  };

  module.exports = start;

}).call(this);
